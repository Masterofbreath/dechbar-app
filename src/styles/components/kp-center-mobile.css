/* ============================================================
   KP Center Mobile Styles
   Fullscreen immersive mode for mobile devices
   Based on Session Engine mobile patterns
   ============================================================ */

@media (max-width: 768px) {
  /* Modal container - fullscreen */
  .kp-center {
    position: fixed !important;
    inset: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-width: none !important;
    max-height: none !important;
    border-radius: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    z-index: 10002 !important;
    background: var(--color-background) !important;
    display: flex !important;
    flex-direction: column !important;
  }
  
  /* Overlay - no padding on mobile */
  .modal-overlay {
    padding: 0 !important;
  }
  
  /* Content area - full height with safe areas */
  .kp-center__measurement-area {
    position: relative !important;
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    /* ✅ PWA FIX: Rovnoměrný padding pro TRUE vertical center
       iOS safe areas: top ~47px, bottom ~34px
       Používáme max() z obou hodnot pro symetrii */
    padding: 
      max(34px, env(safe-area-inset-top))
      max(20px, env(safe-area-inset-right))
      max(34px, env(safe-area-inset-bottom))
      max(20px, env(safe-area-inset-left)) !important;
  }
  
  /* ✅ CloseButton positioning MOVED to fullscreen-modal-mobile.css */
  
  /* Progress indicator - above circle (same position as result message) */
  .kp-center__progress-indicator {
    position: fixed !important;
    top: max(70px, env(safe-area-inset-top) + 54px) !important;  /* ✅ Nad kruhem, pod title */
    left: 0 !important;
    right: 0 !important;
    text-align: center !important;
    padding: 0 20px !important;
    z-index: 1 !important;
  }
  
  /* ✅ Title positioning MOVED to fullscreen-modal-mobile.css */
  
  /* Description - below title */
  .kp-center__description {
    position: fixed !important;
    top: max(95px, env(safe-area-inset-top) + 79px) !important;
    left: 0 !important;
    right: 0 !important;
    text-align: center !important;
    font-size: 14px !important;
    padding: 0 20px !important;
    margin: 0 !important;
    z-index: 1 !important;
  }
  
  /* Breathing circle - absolute center (via shared component CSS) */
  /* Already handled in breathing-circle.css */
  
  /* Touch target optimization - ensure all buttons meet iOS standard (48x48px min) */
  /* MUST come before more specific .button selectors for proper specificity */
  .button {
    min-height: 48px !important;
    min-width: 48px !important;
    padding: 12px 24px !important;
  }
  
  /* Actions - fixed bottom center, 75% width */
  .kp-center__actions,
  .kp-center__measurement-area > .button {
    position: fixed !important;
    bottom: max(40px, env(safe-area-inset-bottom) + 20px) !important;
    left: 50% !important;          /* ✅ Center horizontally */
    transform: translateX(-50%) !important;  /* ✅ Perfect centering */
    width: 75% !important;         /* ✅ User request: 75% width */
    max-width: 320px !important;   /* ✅ Reduced from 420px */
    padding: 0 !important;         /* ✅ No padding on container */
    z-index: 5 !important;
  }
  
  /* Ensure button fills container */
  .kp-center__actions > .button,
  .kp-center__measurement-area > .button {
    width: 100% !important;
  }
  
  /* Instruction text - above button */
  .kp-center__instruction {
    position: fixed !important;
    bottom: max(110px, env(safe-area-inset-bottom) + 90px) !important;
    left: 0 !important;
    right: 0 !important;
    text-align: center !important;
    font-size: 14px !important;
    padding: 0 20px !important;
    margin: 0 !important;
    z-index: 5 !important;
  }
  
  /* Help link - above button (same position as instruction) */
  .kp-center__help {
    position: fixed !important;
    bottom: max(110px, env(safe-area-inset-bottom) + 90px) !important;  /* ✅ Consistent with MiniTip */
    left: 0 !important;
    right: 0 !important;
    text-align: center !important;
    font-size: 14px !important;
    padding: 0 20px !important;
    margin: 0 !important;
    z-index: 5 !important;
  }
  
  /* Result message - above circle */
  .kp-center__result-message {
    position: fixed !important;
    top: max(120px, env(safe-area-inset-top) + 104px) !important;
    left: 0 !important;
    right: 0 !important;
    text-align: center !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
    padding: 0 20px !important;
    margin: 0 !important;
    max-width: 400px !important;
    margin-left: auto !important;
    margin-right: auto !important;
    z-index: 1 !important;
  }
  
  /* Instructions fullscreen */
  .kp-center__instructions-fullscreen {
    position: relative !important;
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    padding: 
      max(80px, env(safe-area-inset-top) + 64px)  /* ✅ VARIANTA D: Z 50px → 80px (+30px aggressive) */
      max(20px, env(safe-area-inset-right))
      max(140px, env(safe-area-inset-bottom) + 120px)  /* ✅ VARIANTA D: Z 100px → 140px (+40px pro MiniTip!) */
      max(20px, env(safe-area-inset-left)) !important;
    overflow-y: auto !important;
  }
  
  /* Instructions list */
  .kp-center__instructions-list {
    font-size: 14px !important;
    line-height: 1.6 !important;
    margin-bottom: 32px !important;
  }
  
  /* ✅ Instructions spacing MOVED to fullscreen-modal-mobile.css */
  
  /* Instructions button - 75% width for consistency */
  .kp-center__instructions-fullscreen > .button {
    position: fixed !important;
    bottom: max(40px, env(safe-area-inset-bottom) + 20px) !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 75% !important;         /* ✅ Consistent with other buttons */
    max-width: 320px !important;   /* ✅ Reduced from 420px */
    padding: 0 !important;
    z-index: 5 !important;
  }
  
  .kp-center__instructions-fullscreen > .button > * {
    width: 100% !important;
  }
  
  /* MiniTip v instrukcích - nad tlačítkem */
  .kp-center__instructions-fullscreen .mini-tip {
    position: fixed !important;
    bottom: max(120px, env(safe-area-inset-bottom) + 100px) !important;  /* ✅ Nad buttonem (který je na 40px) */
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 85% !important;
    max-width: 320px !important;
    z-index: 4 !important;  /* Pod buttonem (button má z-index: 5) */
  }
  
  /* KP Timer - Větší font pro "XXs" formát (konzistentní s výsledky) */
  .kp-center__timer {
    font-size: 56px !important;  /* ✅ Zvětšeno z 48px - formát "35s" je kratší než "00:35" */
    font-weight: 700 !important;
    letter-spacing: -0.02em !important;
  }
  
  /* KP Intermediate Value - Stejná velikost jako timer (konzistence) */
  .kp-center__intermediate-value {
    font-size: 56px !important;  /* ✅ Konzistence s timer během měření */
    font-weight: 700 !important;
    letter-spacing: -0.02em !important;
  }
  
  /* KP Final Value - Stejná velikost jako timer (konzistence) */
  .kp-center__final-value {
    font-size: 56px !important;  /* ✅ Konzistence s timer během měření */
    font-weight: 700 !important;
    letter-spacing: -0.02em !important;
  }
  
  /* Progress indicator text - visible above circle */
  .kp-center__progress-text {
    font-size: 14px !important;  /* ✅ Zmenšeno z 16px - menší než result message */
    font-weight: 500 !important;  /* ✅ Medium weight */
    color: var(--color-text-secondary) !important;  /* ✅ Viditelnější než tertiary */
  }
  
  /* Larger tap area for links */
  .text-link {
    padding: 8px 12px;
    margin: -8px -12px;
  }
  
  /* Touch feedback */
  .button:active,
  .text-link:active,
  .close-button:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }
}

/* Landscape mobile (iPhone SE landscape: 667x375) */
@media (max-width: 768px) and (max-height: 600px) and (orientation: landscape) {
  .kp-center {
    overflow-y: auto !important;
  }
  
  .kp-center__measurement-area {
    padding: 16px 20px !important;
  }
  
  /* Breathing circle - smaller in landscape */
  .breathing-circle-container {
    width: 180px !important;
    height: 180px !important;
  }
  
  .kp-center__title {
    font-size: 18px !important;
    top: max(16px, env(safe-area-inset-top)) !important;
  }
  
  .kp-center__actions,
  .kp-center__measurement-area > .button {
    bottom: max(20px, env(safe-area-inset-bottom) + 8px) !important;
  }
}
